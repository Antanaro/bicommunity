# Развертывание на VM: 158.160.24.193

## Шаг 1: Обновление .env файла

Убедитесь, что в `.env` файле указан правильный `FRONTEND_URL`:

```env
FRONTEND_URL=http://158.160.24.193
```

Или если у вас есть домен:
```env
FRONTEND_URL=https://yourdomain.com
```

## Шаг 2: Установка Docker на VM

Подключитесь к VM и установите Docker:

```bash
ssh antanaro@158.160.24.193
```

Затем запустите скрипт настройки (уже скопирован на VM):

```bash
chmod +x ~/setup-vm.sh
sudo ~/setup-vm.sh
```

После установки выйдите и войдите снова:

```bash
exit
ssh antanaro@158.160.24.193
```

## Шаг 3: Копирование проекта на VM

### Вариант A: Автоматически (PowerShell)

```powershell
.\deploy-to-vm.ps1 -VmHost "158.160.24.193" -VmUser "antanaro"
```

### Вариант B: Вручную через Git (если проект в репозитории)

```bash
ssh antanaro@158.160.24.193
cd ~
git clone your-repo-url bicommunity
cd bicommunity
```

### Вариант C: Через SCP

```powershell
# Копирование всего проекта
scp -r -o StrictHostKeyChecking=no . antanaro@158.160.24.193:~/bicommunity
```

## Шаг 4: Настройка на VM

```bash
ssh antanaro@158.160.24.193
cd ~/bicommunity

# Создайте .env файл (если не скопировался)
cp env.template .env
nano .env  # Отредактируйте настройки

# Важно: Убедитесь, что FRONTEND_URL=http://158.160.24.193
```

## Шаг 5: Запуск проекта

```bash
# На VM
cd ~/bicommunity

# Запуск
docker compose up -d

# Проверка статуса
docker compose ps

# Просмотр логов
docker compose logs -f
```

## Шаг 6: Проверка

Откройте в браузере: **http://158.160.24.193**

## Полезные команды

```bash
# Статус контейнеров
docker compose ps

# Логи
docker compose logs -f
docker compose logs backend
docker compose logs postgres

# Перезапуск
docker compose restart backend

# Остановка
docker compose down

# Обновление проекта
cd ~/bicommunity
git pull  # или скопируйте новые файлы
docker compose down
docker compose build
docker compose up -d
```

## Устранение проблем

### Если порты заняты

Проверьте порты:
```bash
sudo netstat -tulpn | grep -E ':(80|443|5432)'
```

Если порт 80 занят, измените в `.env`:
```env
HTTP_PORT=8080
```

### Если контейнеры не запускаются

```bash
docker compose logs
docker compose ps
```

### Если проблемы с базой данных

```bash
docker compose logs postgres
docker compose exec backend npm run check-db
```
